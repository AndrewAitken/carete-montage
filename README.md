# Car√™te Montage

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –º–æ–Ω—Ç–∞–∂–Ω—ã—Ö –ª–∏—Å—Ç–æ–≤ –¥–ª—è –≤–∏–¥–µ–æ —Å –ø–æ–º–æ—â—å—é AI (Gemini 2.5 Flash).

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üé¨ –ó–∞–≥—Ä—É–∑–∫–∞ –≤–∏–¥–µ–æ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑
- ü§ñ AI-powered –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å –ø–æ–º–æ—â—å—é Gemini 2.5 Flash —á–µ—Ä–µ–∑ Replicate
- üìä –î–µ—Ç–∞–ª—å–Ω—ã–µ –º–æ–Ω—Ç–∞–∂–Ω—ã–µ –ª–∏—Å—Ç—ã —Å —Ç–∞–π–º–∫–æ–¥–∞–º–∏, –ø–ª–∞–Ω–∞–º–∏ –∏ –¥–∏–∞–ª–æ–≥–∞–º–∏
- üì• –≠–∫—Å–ø–æ—Ä—Ç –≤ Excel —Ñ–æ—Ä–º–∞—Ç
- üîê –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —Å email –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º
- üåô –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ç–µ–º–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

## –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **Frontend/Backend**: Next.js 14 (App Router), TypeScript, Tailwind CSS
- **Database**: Supabase (PostgreSQL)
- **Authentication**: Supabase Auth
- **Storage**: Supabase Storage
- **AI Processing**: Replicate API (Gemini 2.5 Flash)
- **Export**: xlsx

## –ù–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
npm install
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Supabase

1. –û—Ç–∫—Ä–æ–π—Ç–µ [SETUP.md](./SETUP.md) –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π
2. –ü—Ä–∏–º–µ–Ω–∏—Ç–µ SQL –º–∏–≥—Ä–∞—Ü–∏—é –∏–∑ —Ñ–∞–π–ª–∞ `supabase-migration.sql` –≤ Supabase SQL Editor
3. –°–æ–∑–¥–∞–π—Ç–µ Storage bucket `videos`
4. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ Storage policies (–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –≤ SETUP.md)

### 3. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–§–∞–π–ª `.env.local` —É–∂–µ —Å–æ–∑–¥–∞–Ω —Å –≤–∞—à–∏–º–∏ –∫–ª—é—á–∞–º–∏. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã:

```env
NEXT_PUBLIC_SUPABASE_URL=https://goykmdyodqhptkzfgumq.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_anon_key
SUPABASE_SERVICE_ROLE_KEY=your_service_role_key
REPLICATE_API_TOKEN=your_replicate_token
```

### 4. –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```bash
npm run dev
```

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ –Ω–∞ http://localhost:3000

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
carete-montage/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ upload/route.ts         # –ó–∞–≥—Ä—É–∑–∫–∞ –≤–∏–¥–µ–æ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ process-video/route.ts  # –û–±—Ä–∞–±–æ—Ç–∫–∞ —á–µ—Ä–µ–∑ Gemini
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ export/[videoId]/       # –≠–∫—Å–ø–æ—Ä—Ç –≤ Excel
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ videos/[id]/            # –£–¥–∞–ª–µ–Ω–∏–µ –≤–∏–¥–µ–æ
‚îÇ   ‚îú‚îÄ‚îÄ auth/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ login/                  # –°—Ç—Ä–∞–Ω–∏—Ü–∞ –≤—Ö–æ–¥–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ register/               # –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ callback/               # Email –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
‚îÇ   ‚îú‚îÄ‚îÄ dashboard/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ page.tsx                # –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ [videoId]/page.tsx      # –ü—Ä–æ—Å–º–æ—Ç—Ä –º–æ–Ω—Ç–∞–∂–Ω–æ–≥–æ –ª–∏—Å—Ç–∞
‚îÇ   ‚îú‚îÄ‚îÄ layout.tsx
‚îÇ   ‚îî‚îÄ‚îÄ page.tsx
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ DashboardClient.tsx         # –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ (–∫–ª–∏–µ–Ω—Ç)
‚îÇ   ‚îú‚îÄ‚îÄ VideoCard.tsx               # –ö–∞—Ä—Ç–æ—á–∫–∞ –≤–∏–¥–µ–æ
‚îÇ   ‚îú‚îÄ‚îÄ UploadModal.tsx             # –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∑–∞–≥—Ä—É–∑–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ UserMenu.tsx                # –ú–µ–Ω—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
‚îÇ   ‚îî‚îÄ‚îÄ MontageTableClient.tsx      # –¢–∞–±–ª–∏—Ü–∞ –º–æ–Ω—Ç–∞–∂–Ω–æ–≥–æ –ª–∏—Å—Ç–∞
‚îú‚îÄ‚îÄ lib/
‚îÇ   ‚îú‚îÄ‚îÄ supabase/                   # –ö–ª–∏–µ–Ω—Ç—ã Supabase
‚îÇ   ‚îú‚îÄ‚îÄ parseGeminiResponse.ts      # –ü–∞—Ä—Å–µ—Ä –æ—Ç–≤–µ—Ç–æ–≤ AI
‚îÇ   ‚îî‚îÄ‚îÄ gemini-prompt.ts            # –ü—Ä–æ–º–ø—Ç –¥–ª—è Gemini
‚îú‚îÄ‚îÄ types/
‚îÇ   ‚îî‚îÄ‚îÄ index.ts                    # TypeScript —Ç–∏–ø—ã
‚îî‚îÄ‚îÄ middleware.ts                   # –ó–∞—â–∏—Ç–∞ –º–∞—Ä—à—Ä—É—Ç–æ–≤
```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### 1. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ `/auth/register`
2. –í–≤–µ–¥–∏—Ç–µ email –∏ –ø–∞—Ä–æ–ª—å
3. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ email –ø–æ —Å—Å—ã–ª–∫–µ –≤ –ø–∏—Å—å–º–µ

### 2. –ó–∞–≥—Ä—É–∑–∫–∞ –≤–∏–¥–µ–æ

1. –ü–æ—Å–ª–µ –≤—Ö–æ–¥–∞ –Ω–∞–∂–º–∏—Ç–µ "–ù–æ–≤—ã–π –ª–∏—Å—Ç"
2. –ó–∞–≥—Ä—É–∑–∏—Ç–µ –≤–∏–¥–µ–æ (drag & drop –∏–ª–∏ –≤—ã–±–æ—Ä —Ñ–∞–π–ª–∞)
3. –î–æ–∂–¥–∏—Ç–µ—Å—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ (—Å—Ç–∞—Ç—É—Å –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)

### 3. –ü—Ä–æ—Å–º–æ—Ç—Ä –º–æ–Ω—Ç–∞–∂–Ω–æ–≥–æ –ª–∏—Å—Ç–∞

1. –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫—É –≥–æ—Ç–æ–≤–æ–≥–æ –≤–∏–¥–µ–æ
2. –ü—Ä–æ—Å–º–æ—Ç—Ä–∏—Ç–µ —Ç–∞–±–ª–∏—Ü—É —Å –ø–ª–∞–Ω–∞–º–∏, —Ç–∞–π–º–∫–æ–¥–∞–º–∏ –∏ –¥–∏–∞–ª–æ–≥–∞–º–∏
3. –†–∞–∑–≤–µ—Ä–Ω–∏—Ç–µ –¥–ª–∏–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏ –∫–Ω–æ–ø–∫–æ–π —Å–æ —Å—Ç—Ä–µ–ª–∫–æ–π

### 4. –≠–∫—Å–ø–æ—Ä—Ç –≤ Excel

1. –ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –º–æ–Ω—Ç–∞–∂–Ω–æ–≥–æ –ª–∏—Å—Ç–∞ –Ω–∞–∂–º–∏—Ç–µ "–°–∫–∞—á–∞—Ç—å excel"
2. –ò–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –∏–∫–æ–Ω–∫—É —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–µ –≤–∏–¥–µ–æ –≤ dashboard

## API Endpoints

### POST `/api/upload`
–ó–∞–≥—Ä—É–∑–∫–∞ –≤–∏–¥–µ–æ –≤ Supabase Storage –∏ –∑–∞–ø—É—Å–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏.

**Body (FormData):**
- `file`: Video file
- `userId`: User ID

**Response:**
```json
{
  "success": true,
  "video": { ... }
}
```

### POST `/api/process-video`
–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–∏–¥–µ–æ —á–µ—Ä–µ–∑ Replicate API (Gemini 2.5 Flash).

**Body:**
```json
{
  "videoId": "uuid",
  "videoUrl": "signed_url"
}
```

**Response:**
```json
{
  "success": true,
  "sheetId": "uuid",
  "entriesCount": 42
}
```

### GET `/api/export/[videoId]`
–≠–∫—Å–ø–æ—Ä—Ç –º–æ–Ω—Ç–∞–∂–Ω–æ–≥–æ –ª–∏—Å—Ç–∞ –≤ Excel.

**Response:** Excel file (application/vnd.openxmlformats-officedocument.spreadsheetml.sheet)

### DELETE `/api/videos/[id]`
–£–¥–∞–ª–µ–Ω–∏–µ –≤–∏–¥–µ–æ –∏ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.

**Response:**
```json
{
  "success": true
}
```

## –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü—ã

- `profiles` - –ü—Ä–æ—Ñ–∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- `videos` - –ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –≤–∏–¥–µ–æ
- `montage_sheets` - –ú–æ–Ω—Ç–∞–∂–Ω—ã–µ –ª–∏—Å—Ç—ã
- `montage_entries` - –ó–∞–ø–∏—Å–∏ –≤ –º–æ–Ω—Ç–∞–∂–Ω—ã—Ö –ª–∏—Å—Ç–∞—Ö (–ø–ª–∞–Ω—ã)

### Row Level Security (RLS)

–í—Å–µ —Ç–∞–±–ª–∏—Ü—ã –∑–∞—â–∏—â–µ–Ω—ã RLS –ø–æ–ª–∏—Ç–∏–∫–∞–º–∏ - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ.

## –î–µ–ø–ª–æ–π

### Vercel (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Vercel CLI
npm i -g vercel

# –î–µ–ø–ª–æ–π
vercel

# –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ Vercel Dashboard
```

## Troubleshooting

### –í–∏–¥–µ–æ –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Replicate API token –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ Storage bucket –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ

### –û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Email provider –≤–∫–ª—é—á–µ–Ω –≤ Supabase
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Site URL –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö Supabase

### –ù–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –≤–∏–¥–µ–æ

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Storage policies –≤ Supabase
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ bucket `videos` —Å–æ–∑–¥–∞–Ω

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ —É –≤–∞—Å –≤–æ–∑–Ω–∏–∫–ª–∏ –≤–æ–ø—Ä–æ—Å—ã –∏–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã, —Å–æ–∑–¥–∞–π—Ç–µ issue –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏.
